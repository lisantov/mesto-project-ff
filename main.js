(()=>{"use strict";var t=new Promise((function(t,e){fetch("https://mesto.nomoreparties.co/v1/wff-cohort-37/users/me",{headers:{authorization:"2a964a3a-30c9-4a52-983e-4a7ed5570f90"}}).then((function(t){return t.ok?t.json():e("Что-то пошло не так: ".concat(t.status))})).then((function(e){return t(e)})).catch((function(t){e(t)}))})),e=new Promise((function(t,e){fetch("https://mesto.nomoreparties.co/v1/wff-cohort-37/cards",{headers:{authorization:"2a964a3a-30c9-4a52-983e-4a7ed5570f90"}}).then((function(t){return t.ok?t.json():e("Что-то пошло не так: ".concat(t.status))})).then((function(e){return t(e)})).catch((function(t){e(t)}))})),o=document.querySelector("#card-template").content;function n(t,e,n,r,a){var c=o.querySelector(".card").cloneNode(!0),i=c.querySelector(".card__image"),u=c.querySelector(".card__title"),p=c.querySelector(".card__delete-button"),l=c.querySelector(".card__like-button"),s=c.querySelector(".card__like-amount");return i.src=t.link,i.alt=t.name,u.textContent=t.name,s.textContent=t.likes.length,e!==t.owner._id&&(p.style.display="none"),i.addEventListener("click",(function(){return a(t)})),p.addEventListener("click",(function(){return n(c,t)})),l.addEventListener("click",(function(e){var o;r(e,t),l.classList.contains("card__like-button_is-active")?(o=t._id,fetch("https://nomoreparties.co/v1/wff-cohort-37/cards/likes/".concat(o),{method:"PUT",headers:{authorization:"2a964a3a-30c9-4a52-983e-4a7ed5570f90"}})).then((function(t){return t.ok?t.json():Promise.reject("Что то пошло не так при запросе на установку лайка: ".concat(t.status))})).then((function(t){s.textContent=t.likes.length})).catch((function(t){return console.error(t)})):function(t){return fetch("https://nomoreparties.co/v1/wff-cohort-37/cards/likes/".concat(t),{method:"DELETE",headers:{authorization:"2a964a3a-30c9-4a52-983e-4a7ed5570f90"}})}(t._id).then((function(t){return t.ok?t.json():Promise.reject("Что то пошло не так при запросе на снятие лайка: ".concat(t.status))})).then((function(t){s.textContent=t.likes.length})).catch((function(t){return console.error(t)}))})),c}function r(t,e){t.target.classList.toggle("card__like-button_is-active")}function a(t,e){fetch("https://nomoreparties.co/v1/wff-cohort-37/cards/".concat(e._id),{method:"DELETE",headers:{authorization:"2a964a3a-30c9-4a52-983e-4a7ed5570f90"}}).then((function(t){return t.ok?t:(console.log(t),Promise.reject("Что то пошло не так при запросе удаления карточки: ".concat(t.status)))})).catch((function(t){return console.error(t)})),t.remove()}function c(t){"Escape"===t.key&&u(document.querySelector(".popup_is-opened"))}function i(t){(t.target.classList.contains("popup__close")||t.target.classList.contains("popup"))&&u(document.querySelector(".popup_is-opened"))}function u(t){document.removeEventListener("keydown",c),t.classList.remove("popup_is-opened")}function p(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",c),t.addEventListener("click",i)}function l(t,e,o){var n=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(o.inputErrorClass),n.textContent=""}function s(t,e){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?e.disabled=!1:e.disabled=!0}function d(t,e){var o=t.querySelectorAll(e.inputSelector);o.forEach((function(o){l(t,o,e)})),s(Array.from(o),t.querySelector(e.submitButtonSelector))}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,n=Array(e);o<e;o++)n[o]=t[o];return n}var f,_={cardsContainer:document.querySelector(".places__list"),editPopup:document.querySelector(".popup_type_edit"),avatarPopup:document.querySelector(".popup_type_avatar"),addCardPopup:document.querySelector(".popup_type_new-card"),imagePopup:document.querySelector(".popup_type_image"),imagePopup_image:document.querySelector(".popup__image"),imagePopup_caption:document.querySelector(".popup__caption"),editButton:document.querySelector(".profile__edit-button"),addButton:document.querySelector(".profile__add-button"),profileImage:document.querySelector(".profile__image"),profileName:document.querySelector(".profile__title"),profileDesc:document.querySelector(".profile__description"),editForm:document.forms["edit-profile"],editForm_nameInput:document.forms["edit-profile"].elements.name,editForm_jobInput:document.forms["edit-profile"].elements.description,avatarForm:document.forms["change-avatar"],avatar_linkInput:document.forms["change-avatar"].elements.link,addForm:document.forms["new-place"],addForm_nameInput:document.forms["new-place"].elements["place-name"],addForm_linkInput:document.forms["new-place"].elements.link},h="";function v(t){_.imagePopup_image.src=t.link,_.imagePopup_image.alt=t.name,_.imagePopup_caption.textContent=t.name,p(_.imagePopup)}_.editButton.addEventListener("click",(function(){var t,e,o;e=(t=_.editForm.elements).name,o=t.description,e.value=_.profileName.textContent,o.value=_.profileDesc.textContent,d(_.editForm,{formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inputErrorClass:"popup__input_invalid"}),p(_.editPopup)})),_.profileImage.addEventListener("click",(function(){_.avatarForm.reset(),d(_.editForm,{formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inputErrorClass:"popup__input_invalid"}),p(_.avatarPopup)})),_.addButton.addEventListener("click",(function(){_.addForm.reset(),d(_.addForm,{formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inputErrorClass:"popup__input_invalid"}),p(_.addCardPopup)})),_.editForm.addEventListener("submit",(function(t){t.preventDefault();var e=_.editForm_nameInput.value,o=_.editForm_jobInput.value;_.profileName.textContent=e,_.profileDesc.textContent=o,_.editForm.querySelector(".popup__button").textContent="Сохранение...",function(t,e){return fetch("https://nomoreparties.co/v1/wff-cohort-37/users/me",{method:"PATCH",headers:{authorization:"2a964a3a-30c9-4a52-983e-4a7ed5570f90","content-type":"application/json"},body:JSON.stringify({name:t,about:e})})}(e,o).then((function(t){return t.ok?t.json():Promise.reject("Ошибка при запросе на обновление профиля: ".concat(t.status))})).catch((function(t){return console.error(t)})).finally((function(){_.editForm.querySelector(".popup__button").textContent="Сохранить",u(_.editPopup)}))})),_.avatarForm.addEventListener("submit",(function(t){t.preventDefault();var e=_.avatar_linkInput.value;_.profileImage.style.backgroundImage="url('".concat(e,"');"),_.avatarForm.querySelector(".popup__button").textContent="Сохранение...",function(t){return fetch("https://nomoreparties.co/v1/wff-cohort-37/users/me/avatar",{method:"PATCH",headers:{authorization:"2a964a3a-30c9-4a52-983e-4a7ed5570f90","content-type":"application/json"},body:JSON.stringify({avatar:t})})}(e).then((function(t){return t.ok?t.json():Promise.reject("Ошибка при запросе на обновление аватарки: ".concat(t.status))})).catch((function(t){return console.error(t)})).finally((function(){_.avatarForm.querySelector(".popup__button").textContent="Сохранить",u(_.avatarPopup)}))})),_.addForm.addEventListener("submit",(function(t){t.preventDefault();var e,o,c=_.addForm_nameInput,i=_.addForm_linkInput,p={name:c.value,link:i.value};_.addForm.querySelector(".popup__button").textContent="Сохранение...",(e=p.name,o=p.link,fetch("https://nomoreparties.co/v1/wff-cohort-37/cards",{method:"POST",headers:{authorization:"2a964a3a-30c9-4a52-983e-4a7ed5570f90","content-type":"application/json"},body:JSON.stringify({name:e,link:o})})).then((function(t){return t.ok?t.json():Promise.reject("Ошибка при запросе на добавление карточки: ".concat(t.status))})).then((function(t){return _.cardsContainer.prepend(n(t,h,a,r,v))})).catch((function(t){return console.error(t)})).finally((function(){_.addForm.querySelector(".popup__button").textContent="Сохранить",u(_.addCardPopup)}))})),f={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inputErrorClass:"popup__input_invalid"},Array.from(document.querySelectorAll(f.formSelector)).forEach((function(t){!function(t,e){var o=Array.from(t.querySelectorAll(e.inputSelector)),n=t.querySelector(e.submitButtonSelector);s(o,n),o.forEach((function(r){r.addEventListener("input",(function(){s(o,n),function(t,e,o){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?l(t,e,o):function(t,e,o,n){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.add(n.inputErrorClass),r.textContent=o}(t,e,e.validationMessage,o)}(t,r,e)}))}))}(t,f)})),Promise.all([t,e]).then((function(t){var e,o,c=(o=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var o=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=o){var n,r,a,c,i=[],u=!0,p=!1;try{if(a=(o=o.call(t)).next,0===e){if(Object(o)!==o)return;u=!1}else for(;!(u=(n=a.call(o)).done)&&(i.push(n.value),i.length!==e);u=!0);}catch(t){p=!0,r=t}finally{try{if(!u&&null!=o.return&&(c=o.return(),Object(c)!==c))return}finally{if(p)throw r}}return i}}(e,o)||function(t,e){if(t){if("string"==typeof t)return m(t,e);var o={}.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?m(t,e):void 0}}(e,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=c[0],u=c[1];h=i._id,function(t){_.profileImage.style.backgroundImage="url('".concat(t.avatar,"')"),_.profileName.textContent=t.name,_.profileDesc.textContent=t.about}(i),function(t){t.forEach((function(t){_.cardsContainer.prepend(n(t,h,a,r,v))}))}(u)})).catch((function(t){alert(t),console.error(t)}))})();